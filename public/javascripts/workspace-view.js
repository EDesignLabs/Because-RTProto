// Generated by CoffeeScript 1.3.3

define(['context-view', 'note-view', 'marker-view'], function(ContextView, NoteView, MarkerView) {
  var WorkspaceView;
  return WorkspaceView = Backbone.View.extend({
    className: 'span12',
    initialize: function(options) {
      var data;
      this.constructor.__super__.initialize.call(this, options);
      this.setElement(document.createElementNS('http://www.w3.org/2000/svg', 'svg'));
      this.d3el = d3.select(this.el);
      this.model.addEventListener(gapi.drive.realtime.EventType.OBJECT_CHANGED, _.bind(this.onObjectChanged, this));
      this.model.get('notes').addEventListener(gapi.drive.realtime.EventType.VALUES_ADDED, _.bind(this.onNotesAdded, this));
      this.model.get('markers').addEventListener(gapi.drive.realtime.EventType.VALUES_ADDED, _.bind(this.onMarkersAdded, this));
      data = this.model.get('data');
      this.contextView = new ContextView({
        model: data.get('image'),
        parent: this.d3el
      });
      _.each(this.model.get('markers').asArray(), function(marker) {
        return this.addMarker(marker);
      }, this);
      return _.each(this.model.get('notes').asArray(), function(note) {
        return this.addNote(note);
      }, this);
    },
    onObjectChanged: function() {},
    onNotesAdded: function(rtEvent) {
      return _.each(rtEvent.values, function(note) {
        return this.addNote(note);
      }, this);
    },
    onMarkersAdded: function(rtEvent) {
      return _.each(rtEvent.values, function(marker) {
        return this.addMarker(marker);
      }, this);
    },
    addNote: function(note) {
      var noteView;
      noteView = new NoteView({
        model: note,
        parent: this.d3el
      });
      return noteView.render();
    },
    addMarker: function(marker) {
      var markerView;
      markerView = new MarkerView({
        model: marker,
        parent: this.d3el
      });
      return markerView.render();
    },
    render: function() {
      return this.contextView.render();
    }
  });
});
